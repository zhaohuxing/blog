---
title: "MySQL 理论 - 笔记"
date: 2021-05-20T00:00:00+08:00
draft: false
tags: ["mysql"]

---

#### MySQL 事务隔离级别

ACID：原子性、一致性、隔离性、持久性

**隔离级别：**

- 读未提交
- 读提交
- 可重复读
- 串行化



可重复读呢，我开启了事务，还没结束，又开了事务且修改了值，但是我看到的还是我开启事务前看到的。

可重复读的实现：

在 MySQL 中，实际上每条记录在更新的时候都会同时记录一条回滚记录。记录上的最新值，通过回滚操作，都可以得到前一个状态的值。

同一条记录在系统中可以存在多个版本，就是数据库的多版本并发控制（MVCC），要想获取某个视图，需要将当前值依次执行回滚所得到的。

#### MySQL 索引原理

MySQL 索引是一个 B+ Tree。B+Tree 是 B Tree + 其叶子节点都按照非递减连接起来了，也就是 key 比大等于 key 左边的元素，小于右边的元素。

进行查找操作，首先在根节点进行二分查找，找到一个 key 所在的指针，然后递归地在指针所指向的节点进行查找，直到查找到叶子节点。

跟红黑树比，B+ Tree 高度小，减少读写磁盘的时间。

索引是在存储引擎实现的，而不是服务器层，不同的引擎具有不同的实现。

InnoDB 的 B+Tree 索引分为主索引和辅助索引。主索引的叶子节点 data 域记录着完整的数据记录，这种索引称为聚簇索引。因为无法把数据行存放在两个不同地方，所以一个表只能有一个聚簇索引。

辅助索引的叶子节点 data 域记录着主键的值，因此在使用辅助索引进行查找时，需要找到主键值，然后再到主索引中进行查找。

#### MySQL 主从复制

主要涉及到三个线程：binlog 线程、IO 线程和 SQL 线程。

- binlog 线程：负责将主服务器上的数据更改写入到二进制日志中
- IO 线程：负责从主服务器上读取二进制日志，并写入从服务器的中续日志。
- SQL 线程：负责读取中续日志，解析出主服务器已经执行的数据更改并在从服务器中重放。
